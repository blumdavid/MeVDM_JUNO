""" script to display the DSNB flux, the IBD cross-section and the theoretical DSNB spectrum in JUNO

    The DSNB flux is taken from function dsnb_background_v4() of gen_spectrum_functions.py

    Data of the flux is taken from file 1705.02122_DSNB_flux_Figure_8.txt of paper 1705.02122 (provided by Julia)

"""
import numpy as np
from matplotlib import pyplot as plt
from gen_spectrum_functions import sigma_ibd

# set neutrino energy in MeV:
energy_neutrino = np.arange(10, 100.05, 0.05)

# mass of positron in MeV (reference PDG 2016) (float constant):
MASS_POSITRON = 0.51099892
# mass of proton in MeV (reference PDG 2016) (float constant):
MASS_PROTON = 938.27203
# mass of neutron in MeV (reference PDG 2016) (float constant):
MASS_NEUTRON = 939.56536
# difference MASS_NEUTRON - MASS_PROTON in MeV (float):
DELTA = MASS_NEUTRON - MASS_PROTON

# calculate IBD cross-section in cm^2:
crosssection = sigma_ibd(energy_neutrino, DELTA, MASS_POSITRON)

# set number of free protons:
n_target = 1.45 * 10**33

# total exposure time in years:
t_years = 10
# total exposure time in seconds:
t = t_years * 3.156 * 10 ** 7

# set IBD detection efficiency:
detection_efficiency = 0.67005

# muon veto cut efficiency:
exposure_ratio_muon = 0.9717

# Neutrino energy in MeV corresponding to the data points of the DSNB flux:
energy_data = np.arange(10, 50.05, 0.05)
energy_data_2 = np.array([50.1])
# add data point of 0.0 / (cm^2 * MeV * s) for 50.1 MeV:
energy_data = np.append(energy_data, energy_data_2)

# DSNB flux of electron-antineutrinos for f_BH = 0.27, z_max = 2 and fixed star formation rate in 1/(cm^2 MeV s):
flux_data = np.array([0.62774, 0.622145, 0.616551, 0.610956, 0.605361, 0.599767, 0.594172, 0.588577, 0.582983,
                      0.577388, 0.571794, 0.5666, 0.561406, 0.556212, 0.551018, 0.545824, 0.54063, 0.535437,
                      0.530243, 0.525049, 0.519855, 0.515062, 0.51027, 0.505477, 0.500685, 0.495892, 0.4911,
                      0.486307, 0.481515, 0.476722, 0.47193, 0.46753, 0.463129, 0.458729, 0.454329,
                      0.449929, 0.445529, 0.441129, 0.436729, 0.432329, 0.427929, 0.423904, 0.41988, 0.415855,
                      0.411831, 0.407807, 0.403782, 0.399758, 0.395733, 0.391709, 0.387685, 0.384016, 0.380346,
                      0.376677, 0.373008, 0.369339, 0.36567, 0.362001, 0.358332, 0.354663, 0.350994, 0.347657,
                      0.34432, 0.340984, 0.337647, 0.33431, 0.330973, 0.327636, 0.3243, 0.320963, 0.317626,
                      0.314598, 0.311569, 0.308541, 0.305513, 0.302484, 0.299456, 0.296428, 0.293399, 0.290371,
                      0.287343, 0.284599, 0.281854, 0.27911, 0.276366, 0.273622, 0.270878, 0.268133, 0.265389,
                      0.262645, 0.259901, 0.257417, 0.254934, 0.25245, 0.249967, 0.247483, 0.244999, 0.242516,
                      0.240032, 0.237549, 0.235065, 0.23282, 0.230574, 0.228328, 0.226083, 0.223837, 0.221591,
                      0.219346, 0.2171, 0.214855, 0.212609, 0.21058, 0.208551, 0.206522, 0.204493, 0.202464,
                      0.200435, 0.198406, 0.196377, 0.194348, 0.192319, 0.190487, 0.188655, 0.186822, 0.18499,
                      0.183158, 0.181326, 0.179493, 0.177661, 0.175829, 0.173996, 0.172342, 0.170688, 0.169034,
                      0.16738, 0.165726, 0.164072, 0.162418, 0.160764, 0.15911, 0.157456, 0.155963, 0.15447,
                      0.152977, 0.151484, 0.149991, 0.148499, 0.147006, 0.145513, 0.14402, 0.142527, 0.14118,
                      0.139833, 0.138486, 0.137138, 0.135791, 0.134444, 0.133097, 0.13175, 0.130402, 0.129055,
                      0.127839, 0.126624, 0.125408, 0.124192, 0.122976, 0.121761, 0.120545, 0.119329, 0.118113,
                      0.116897, 0.1158, 0.114703, 0.113606, 0.112509, 0.111411, 0.110314, 0.109217, 0.10812,
                      0.107022, 0.105925, 0.104935, 0.103944, 0.102954, 0.101964, 0.100973, 0.0999828, 0.0989924,
                      0.098002, 0.0970116, 0.0960212, 0.0951271, 0.094233, 0.0933388, 0.0924447, 0.0915506,
                      0.0906564, 0.0897623, 0.0888682, 0.087974, 0.0870799, 0.0862724, 0.085465, 0.0846575,
                      0.08385, 0.0830426, 0.0822351, 0.0814276, 0.0806202, 0.0798127, 0.0790052, 0.0782758,
                      0.0775464, 0.0768169, 0.0760875, 0.0753581, 0.0746286, 0.0738992, 0.0731698, 0.0724403,
                      0.0717109, 0.0710518, 0.0703926, 0.0697335, 0.0690743, 0.0684152, 0.067756, 0.0670969,
                      0.0664377, 0.0657786, 0.0651194, 0.0645236, 0.0639278, 0.063332, 0.0627362, 0.0621403,
                      0.0615445, 0.0609487, 0.0603529, 0.059757, 0.0591612, 0.0586224, 0.0580837, 0.0575449,
                      0.0570061, 0.0564673, 0.0559285, 0.0553897, 0.0548509, 0.0543121, 0.0537734, 0.053286,
                      0.0527986, 0.0523112, 0.0518238, 0.0513364, 0.050849, 0.0503616, 0.0498742, 0.0493868,
                      0.0488994, 0.0484583, 0.0480172, 0.0475761, 0.0471351, 0.046694, 0.0462529, 0.0458118,
                      0.0453707, 0.0449296, 0.0444885, 0.0440891, 0.0436897, 0.0432903, 0.0428909, 0.0424915,
                      0.0420922, 0.0416928, 0.0412934, 0.040894, 0.0404946, 0.0401328, 0.0397711, 0.0394093,
                      0.0390475, 0.0386857, 0.038324, 0.0379622, 0.0376004, 0.0372386,
                      0.0368768, 0.036549, 0.0362211, 0.0358933, 0.0355654, 0.0352375,  0.0349097, 0.0345818,
                      0.034254, 0.0339261, 0.0335982, 0.033301, 0.0330037, 0.0327065, 0.0324092, 0.0321119,
                      0.0318147, 0.0315174, 0.0312202, 0.0309229, 0.0306257, 0.030356, 0.0300864, 0.0298167,
                      0.0295471, 0.0292775, 0.0290078, 0.0287382, 0.0284685, 0.0281989, 0.0279293, 0.0276845,
                      0.0274398, 0.0271951, 0.0269504, 0.0267057, 0.026461, 0.0262163, 0.0259716, 0.0257269,
                      0.0254822, 0.02526, 0.0250379, 0.0248157, 0.0245935, 0.0243713, 0.0241491, 0.0239269,
                      0.0237048, 0.0234826, 0.0232604, 0.0230586, 0.0228567, 0.0226549,
                      0.0224531, 0.0222513, 0.0220494, 0.0218476, 0.0216458, 0.0214439,
                      0.0212421, 0.0210587, 0.0208753, 0.0206918, 0.0205084, 0.020325,
                      0.0201415, 0.0199581, 0.0197747, 0.0195913, 0.0194078, 0.019241,
                      0.0190743, 0.0189075, 0.0187407, 0.0185739, 0.0184071, 0.0182404, 0.0180736, 0.0179068,
                      0.01774, 0.0175883, 0.0174366, 0.0172848, 0.0171331, 0.0169814, 0.0168297, 0.016678,
                      0.0165262, 0.0163745, 0.0162228, 0.0160847, 0.0159466, 0.0158086, 0.0156705, 0.0155324,
                      0.0153943, 0.0152562, 0.0151181, 0.0149801, 0.014842, 0.0147162, 0.0145905, 0.0144648,
                      0.014339, 0.0142133, 0.0140876, 0.0139618, 0.0138361, 0.0137104, 0.0135846, 0.0134701,
                      0.0133556, 0.013241, 0.0131265, 0.0130119, 0.0128974, 0.0127828, 0.0126683, 0.0125538,
                      0.0124392, 0.0123348, 0.0122304, 0.012126, 0.0120216, 0.0119172,
                      0.0118128, 0.0117084, 0.011604, 0.0114996, 0.0113952, 0.0113, 0.0112048, 0.0111096, 0.0110144,
                      0.0109192, 0.010824, 0.0107288, 0.0106336, 0.0105384, 0.0104432, 0.0103564, 0.0102695,
                      0.0101827, 0.0100958, 0.010009, 0.00992212, 0.00983528, 0.00974843, 0.00966158, 0.00957474,
                      0.00949548, 0.00941622, 0.00933696, 0.0092577, 0.00917844, 0.00909918, 0.00901992, 0.00894066,
                      0.0088614, 0.00878214, 0.00870978, 0.00863741, 0.00856504, 0.00849267, 0.0084203, 0.00834793,
                      0.00827556, 0.00820319, 0.00813082, 0.00805845, 0.00799235, 0.00792624, 0.00786014,
                      0.00779403, 0.00772792, 0.00766182, 0.00759571, 0.00752961, 0.0074635, 0.00739739, 0.00733698,
                      0.00727656, 0.00721615, 0.00715573, 0.00709531, 0.0070349, 0.00697448, 0.00691407, 0.00685365,
                      0.00679323, 0.006738, 0.00668276, 0.00662752, 0.00657228, 0.00651704, 0.0064618, 0.00640656,
                      0.00635132, 0.00629609, 0.00624085, 0.00619032, 0.00613979, 0.00608926, 0.00603873, 0.0059882,
                      0.00593767, 0.00588714, 0.00583661, 0.00578608, 0.00573555, 0.00568931, 0.00564307,
                      0.00559683, 0.00555059, 0.00550435, 0.00545811, 0.00541186, 0.00536562, 0.00531938,
                      0.00527314, 0.00523081, 0.00518848, 0.00514614, 0.00510381, 0.00506148, 0.00501915,
                      0.00497681, 0.00493448, 0.00489215, 0.00484981, 0.00481104, 0.00477227, 0.0047335, 0.00469473,
                      0.00465596, 0.00461719, 0.00457842, 0.00453965, 0.00450088, 0.00446211, 0.00442658,
                      0.00439106, 0.00435554, 0.00432001, 0.00428449, 0.00424897, 0.00421344, 0.00417792, 0.0041424,
                      0.00410687, 0.00407431, 0.00404175, 0.00400919, 0.00397663, 0.00394407, 0.0039115, 0.00387894,
                      0.00384638, 0.00381382, 0.00378126, 0.0037514, 0.00372154, 0.00369168, 0.00366182, 0.00363196,
                      0.0036021, 0.00357224, 0.00354238, 0.00351252, 0.00348266, 0.00345526, 0.00342787, 0.00340048,
                      0.00337308, 0.00334569, 0.0033183, 0.00329091, 0.00326351, 0.00323612, 0.00320873, 0.00318359,
                      0.00315845, 0.00313331, 0.00310817, 0.00308303, 0.00305789, 0.00303275, 0.00300761,
                      0.00298246, 0.00295732, 0.00293424, 0.00291116, 0.00288808, 0.002865, 0.00284192, 0.00281884,
                      0.00279576, 0.00277268, 0.0027496, 0.00272652, 0.00270532, 0.00268412, 0.00266292, 0.00264172,
                      0.00262052, 0.00259932, 0.00257812, 0.00255692, 0.00253572, 0.00251452, 0.00249505,
                      0.00247557, 0.00245609, 0.00243661, 0.00241714, 0.00239766, 0.00237818, 0.0023587, 0.00233923,
                      0.00231975, 0.00230185, 0.00228394, 0.00226604, 0.00224814, 0.00223023, 0.00221233,
                      0.00219443, 0.00217652, 0.00215862, 0.00214072, 0.00212426, 0.0021078, 0.00209134, 0.00207487,
                      0.00205841, 0.00204195, 0.00202549, 0.00200903, 0.00199257, 0.00197611, 0.00196097,
                      0.00194583, 0.00193068, 0.00191554, 0.0019004, 0.00188526, 0.00187012, 0.00185498, 0.00183984,
                      0.00182469, 0.00181076, 0.00179683, 0.0017829, 0.00176897, 0.00175504, 0.0017411, 0.00172717,
                      0.00171324, 0.00169931, 0.00168538, 0.00167255, 0.00165973, 0.00164691, 0.00163408,
                      0.00162126, 0.00160844, 0.00159561, 0.00158279, 0.00156996, 0.00155714, 0.00154533,
                      0.00153353, 0.00152172, 0.00150991, 0.0014981, 0.0014863, 0.00147449, 0.00146268, 0.00145088,
                      0.00143907, 0.00142819, 0.00141732, 0.00140644, 0.00139556, 0.00138469, 0.00137381,
                      0.00136294, 0.00135206, 0.00134118, 0.00133031, 0.00132029, 0.00131027, 0.00130025,
                      0.00129023, 0.0012802, 0.00127018, 0.00126016, 0.00125014, 0.00124012, 0.0012301, 0.00122086,
                      0.00121163, 0.00120239, 0.00119316, 0.00118392, 0.00117468, 0.00116545,
                      0.00115621, 0.00114698, 0.00113774, 0.00112923, 0.00112071, 0.0011122, 0.00110368, 0.00109517,
                      0.00108665, 0.00107814, 0.00106962, 0.00106111, 0.00105259, 0.00104474, 0.00103689,
                      0.00102904, 0.00102118, 0.00101333, 0.00100548, 0.000997626, 0.000989774, 0.000981921,
                      0.000974069, 0.000966825, 0.000959581, 0.000952337, 0.000945093, 0.000937849, 0.000930605,
                      0.000923361, 0.000916117, 0.000908873, 0.000901629, 0.000894944, 0.000888258, 0.000881573,
                      0.000874888, 0.000868202, 0.000861517, 0.000854831, 0.000848146, 0.00084146, 0.000834775,
                      0.000828603, 0.000822432, 0.000816261, 0.000810089, 0.000803918, 0.000797747, 0.000791575,
                      0.000785404, 0.000779233, 0.000773061, 0.000767363, 0.000761665, 0.000755966, 0.000750268,
                      0.000744569, 0.000738871, 0.000733173, 0.000727474, 0.000721776, 0.000716078, 0.000710815,
                      0.000705552, 0.00070029, 0.000695027, 0.000689764, 0.000684502, 0.000679239, 0.000673976,
                      0.000668714, 0.000663451, 0.00065859, 0.000653728, 0.000648867, 0.000644005, 0.000639144,
                      0.000634282, 0.00062942, 0.000624559, 0.000619697, 0.000614836, 0.000610343, 0.000605851,
                      0.000601358, 0.000596866, 0.000592373, 0.000587881, 0.000583388, 0.000578896, 0.000574404,
                      0.000569911, 0.000565758, 0.000561604, 0.000557451, 0.000553298, 0.000549144, 0.000544991,
                      0.000540837, 0.000536684, 0.000532531, 0.000528377, 0.0])

# interpolate DSNB flux for neutrino energies from 10 to 100 MeV (flux in 1 / (cm^2 * MeV * s)):
flux_dsnb = np.interp(energy_neutrino, energy_data, flux_data)

# Theoretical spectrum of DSNB neutrino events in JUNO after "time" years in 1/MeV (np.array of float64):
theo_spectrum_dsnb = crosssection * flux_dsnb * n_target * t * detection_efficiency * exposure_ratio_muon

# number of neutrinos from DSNB background in JUNO detector after "time":
n_neutrino_dsnb_theo = np.trapz(theo_spectrum_dsnb, energy_neutrino)

h1 = plt.figure(1, figsize=(11, 6))
plt.semilogy(energy_neutrino, flux_dsnb, "b--", label="DSNB flux")
plt.semilogy(energy_neutrino, theo_spectrum_dsnb, "b-", label="DSNB neutrino energy spectrum")
plt.xlabel("Neutrino energy $E_{\\nu}$ in MeV")
plt.ylabel("")
plt.title("DSNB ")
plt.grid()
plt.legend()


fig, ax1 = plt.subplots(1, 1, figsize=(9, 6))

color = 'tab:blue'
ax1.set_xlabel('Neutrino energy $E_{\\nu}$ in MeV', fontsize=12)
ax1.set_ylabel('DSNB neutrino energy spectrum after 10 years of lifetime\nin events/MeV', color=color, fontsize=12)
ax1.plot(energy_neutrino, theo_spectrum_dsnb, color=color)
ax1.tick_params(axis='y', labelcolor=color)
ax1.set_xlim(10.0, 100.0)
ax1.xaxis.grid()
ax1.set_ylim(0.03, 2)
ax1.set_title("DSNB neutrino energy spectrum and DSNB $\\bar{\\nu}_e$ flux"
              "\nin JUNO", fontsize=14)


ax2 = ax1.twinx()  # instantiate a second axes that shares the same x-axis

color = 'tab:red'
ax2.set_ylabel('DSNB electron anti-neutrino flux\nin $\\bar{\\nu}_e$/(cm$^2$ MeV s)', color=color, fontsize=12)
ax2.plot(energy_neutrino, flux_dsnb, color=color)
ax2.tick_params(axis='y', labelcolor=color)
ax2.set_ylim(0.01, 2)

fig.tight_layout()  # otherwise the right y-label is slightly clipped

plt.show()





























